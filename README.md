# TF-IDF Веб-приложение

Веб-приложение, позволяющее пользователям загружать текстовые файлы, анализировать их с помощью алгоритма TF-IDF и отображать 50 лучших слов, ранжированных по их значениям IDF.

## Возможности

- **Загрузка файлов**: Поддержка текстовых файлов размером до 5МБ
- **TF-IDF анализ**: Обработка текста для расчета частоты термина и обратной частоты документа
- **Интерактивные результаты**: Отображение результатов в постраничной таблице
- **Современный интерфейс**: Адаптивный дизайн с использованием Tailwind CSS
- **Хранение в базе данных**: Результаты хранятся в базе данных PostgreSQL
- **Контейнеризация**: Настройка Docker и Docker Compose для простого развертывания

## Технологический стек

- **Бэкенд**: FastAPI, Python 3.11, SQLAlchemy, Alembic
- **База данных**: PostgreSQL
- **Фронтенд**: Jinja2 Templates, Tailwind CSS, Alpine.js
- **Обработка текста**: NLTK для токенизации и стоп-слов
- **Тестирование**: Pytest
- **Развертывание**: Docker, Docker Compose

## Запуск приложения

### Использование Docker Compose

Самый простой способ запустить приложение — использовать Docker Compose, который настроит как само приложение, так и базу данных PostgreSQL:

```bash
# Сборка и запуск стека приложений
make docker-compose-up

# Остановка стека приложений
make docker-compose-down

# Просмотр логов
make docker-compose-logs
```

Приложение будет доступно по адресу `http://localhost:8000`.

### Локальная разработка

Для локальной разработки вам потребуется установить и запустить PostgreSQL:

```bash
# Создайте виртуальную среду
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate

# Установите зависимости
make setup

# Настройте базу данных (измените учетные данные при необходимости)
export DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/tfidf
export SYNC_DATABASE_URL=postgresql://postgres:postgres@localhost:5432/tfidf
psql -U postgres -c "CREATE DATABASE tfidf"

# Запустите миграции
make migrate

# Запустите приложение
make run
```

## Как это работает

1. **Загрузка**: Пользователи загружают текстовый файл через веб-интерфейс.
2. **Обработка**:
   - Файл обрабатывается в фоновом режиме
   - Текст токенизируется и нормализуется
   - Слова фильтруются (удаляются стоп-слова)
   - Рассчитываются метрики TF-IDF
   - Результаты сохраняются в базе данных
3. **Результаты**: 50 слов с наивысшими значениями IDF отображаются в таблице с постраничной навигацией.

## Расчет TF-IDF

- **TF (частота термина)**: Сколько раз слово встречается в тексте
- **DF (частота документа)**: В скольких документах встречается слово
- **IDF (обратная частота документа)**: Log((N+1)/(df+1))+1, где N — количество документов

Поскольку мы имеем дело с одним файлом, приложение разделяет текст на несколько "псевдо-документов" (абзацы или фрагменты), чтобы расчет IDF был более информативным.

## Схема базы данных

- **TextAnalysis**: Хранит информацию о загруженных файлах и статусе их обработки
  - `id`: UUID первичный ключ
  - `filename`: Имя загруженного файла
  - `created_at`: Временная метка загрузки
  - `status`: Статус обработки (processing, completed, failed)
  - `error_message`: Сообщение об ошибке, если обработка не удалась

- **WordResult**: Хранит результаты анализа TF-IDF для каждого слова
  - `id`: Автоинкрементный первичный ключ
  - `analysis_id`: Внешний ключ на TextAnalysis
  - `word`: Анализируемое слово
  - `tf`: Частота термина (количество вхождений)
  - `idf`: Обратная частота документа (оценка значимости)

## Тестирование

```bash
# Запуск тестов
make test

# Запуск с покрытием
make test-cov
```

## Команды для разработки

```bash
# Проверка кода линтерами
make lint

# Создание новой миграции
make migrate-create message="Добавить новое поле"

# Применение миграций
make migrate

# Откат миграций
make migrate-rollback
```

## Лицензия

[MIT License](LICENSE) 